class EmojiReactionsController < ApplicationController
  def create
    @emoji_reaction = find_compliment.emoji_reactions.new(emoji_reaction_params)

    if @emoji_reaction.save
      render partial: 'shared/emoji_reaction', locals: locals
    else
      render json: { errors: @emoji_reaction.errors.full_messages.to_sentence }, status: 500
    end
  end

  def destroy
    @emoji_reaction = find_emoji_reaction

    if @emoji_reaction && @emoji_reaction.destroy
      render partial: 'shared/emoji_reaction', locals: locals
    else
      render json: { errors: "Unable to remove emoji_reaction. :(" }, status: 500
    end
  end

  private

  def find_compliment
    Compliment.find(params[:compliment_id])
  end

  def find_emoji_reaction
    find_compliment.emoji_reactions.where(user_id: current_user.id).first
  end

  def find_emoji
    Emoji.find_by_alias(params[:emoji])
  end

  def emoji_reaction_params
    { user_id: current_user.id, emoji: params[:emoji] }
  end

  def locals
    {
      reactionable: @emoji_reaction.reactionable,
      emoji: find_emoji,
      count: find_compliment.grouped_emoji_reactions[find_emoji].to_i
    }
  end

end
